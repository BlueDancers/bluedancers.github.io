# Vue3版 更简单的后台鉴权-动态路由方案！

## 前言

​	在3年前我发布了一篇vue2后台管理系统动态路由方案，时至今日，vue2已经升级到了vue3，动态路由的实现方案我也做出了一些升级迭代，来帮助开发者更好的完成业务需求。

- **更加简单的实现逻辑**
- **更加便捷的路由配置**



## vue2时期采用的技术方案特点

1. 前端只存储基础的路由树
2. 根据不同的登录角色，返回其对应的可访问路由树
3. 前端获取到路由树（JSON）后递归处理，再通过addRouters拼接到基础路由书，完成动态路由

### 优点

- 相当安全，不允许访问的路由直接是不存在的。

### 缺点

- 代码中仅保存了基础路由，所有的业务路由都需要前端开发人员手动录入到系统之中，非常繁琐
- 客户端逻辑相对复杂，需要递归路由树、addRouters，技术难度相对较大。





有没有什么办法，可以**既保证系统安全性，也保证代码逻辑的简单性，同时保证前端开发者的便捷性呢？**

话都说到这里了，那肯定是有的了。



## 具体方案

​	通过以上分析，我们首先可以明确一点，动态路由的配置数据是需要放在前端项目中，而不是将路由的全部配置信息录入到系统中，

​	不过动态路由的树形结构还是需要录入到系统中，并进行维护的。

![](https://www.vkcyan.top/FtwPoOw9rINtfIO7HSUh7J61DkUC.png)

当我们的路由树交换给前端项目之后，我们也不需要做addRouters了，从开发者的角度来看，这样很不错。

那么在这样的前提下，我们如何实现动态路由的方案呢？



## 实现思路

​	首先将我们的全部路由分成2部分，基础路由数组，动态路由数组；

​	我们项目的pinia中维护一个路由权限数组，如果当前用户访问的路由name在数组中，则允许访问，如果当前路由name不在权限数组中，这认为其没有权限访问。

1. 当触发登录行为的时候，请求服务端，获取当前用户的权限数组（一维），然后权限数组配合动态路由数组，递归出需要显示在侧边栏的路由，同时将权限数组保存到pinia之中。
2. 路由发生跳转的时候，首先判断是否登录状态，如果不是，这直接重定向到登录页面；如果已经登录，则判断当前跳转的路由name是否在权限数组中，如果存在，则正常跳转，如果存在，则直接进入404页面。
3. 刷新页面场景，则会重新获取一次权限数组。



## 具体实现

### 客户端的录入全部路由

### 服务端返回登录角色权限数组

### 客户端反向for循环，计算出侧边栏菜单

### 每次router.beforeEach的进行权限判断

### 刷新页面重新获取权限数组







